import{A as q,r as n,c as f,B as p,O as v,J as m}from"./app-1b98d7d1.js";import{l as T}from"./Validate-f4987cd8.js";import{t as d}from"./toastr-a0e31faa.js";function R(g={},u){const a=q(g),c=n("create"),y=f(()=>m().props.data),t=f(()=>m().props.params),s=n(!1),l=n(null),e=n({perPage:50,query:null,page:1});p(()=>{t.value&&(t.value.page&&(e.value.page=t.value.page),t.value.perPage&&(e.value.perPage=t.value.perPage),t.value.query&&(e.value.query=t.value.query),t.value.sort&&(e.value.sort=t.value.sort),t.value.order&&(e.value.order=t.value.order),t.value.role&&(e.value.role=t.value.role))}),p(()=>{var r=document.getElementById("offCanvasForm");r&&(l.value=new bootstrap.Offcanvas(r))});const i=()=>{l.value&&l.value.hide()},S=()=>{l.value&&l.value.toggle()},h=(r,o)=>{(r=="perPage"||r=="query")&&(e.value.page=1),r=="sort"?e.value.sort&&e.value.sort==o?e.value.order=="asc"?(e.value.sort=o,e.value.order="desc"):(e.value.sort=null,e.value.order=null):(e.value.sort=o,e.value.order="asc"):e.value[r]=o,b()},b=T.debounce(()=>{v.get(route(`${u}.index`,e.value),{},{preserveState:!0,preventScroll:!0,only:["data","params"]})},500),C=async()=>{a.clearErrors(),a.post(route(`${u}.store`),{preserveState:!0,preventScroll:!0,only:["data","params","errors"],onSuccess:()=>{d.success("Record saved"),a.reset(),i()}})},P=async()=>{a.clearErrors(),a.patch(route(`${u}.update`,a.id),{preserveState:!0,preventScroll:!0,only:["data","params","errors"],onSuccess:()=>{d.info("Record updated"),a.reset(),i()}})},O=async r=>{Swal.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel it!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-danger"}}).then(o=>{o.isConfirmed&&v.delete(route(`${u}.destroy`,r),{preserveState:!0,preventScroll:!0,only:["data","params"],onSuccess:()=>{d.error("Record deleted")}})})},B=()=>{w(),v.reload([]),s.value=!1,setTimeout(()=>{s.value=!0},1e3),c.value="create"},E=r=>{r=JSON.parse(JSON.stringify(r)),a.reset(),a.clearErrors();for(const o in r){const x=r[o];a[o]=x}c.value="update",S(),s.value=!1,setTimeout(()=>{s.value=!0},1e3)},w=()=>{a.reset(),a.clearErrors()};return{paginatedData:y,isLoadingComponents:s,form:a,createPromise:C,updatePromise:P,deletePromise:O,handleCreate:B,handleEdit:E,serverQuery:e,handleServerQuery:h,formState:c}}export{R as u};
